# 1. Use a standard Node image
FROM node:20-alpine

# 2. Install pnpm globally
RUN npm install -g pnpm@9

# 3. Set the working directory
WORKDIR /app

# 4. Copy package manifests first (optimizes layer caching)
COPY package.json pnpm-lock.yaml* ./

# 5. Install ALL dependencies (including devDependencies like Next.js)
# We don't use --frozen-lockfile here so it can adapt to your dev environment
RUN pnpm install

# 6. Copy the rest of your source code
COPY . .

# 7. Set environment variables for the Dev Server
ENV NODE_ENV=development
ENV HOST=0.0.0.0
ENV PORT=3000

# 8. Expose the port
EXPOSE 3000

# 9. The Command to start Hot-Reloading
# This overrides any internal 'server.js' logic
CMD ["pnpm", "run", "dev"]